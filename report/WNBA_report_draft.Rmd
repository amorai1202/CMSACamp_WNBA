---
title: "WNBA Player Archetypes & Comparisons"
author: 
 - Amor Ai^[Carnegie Mellon University, amorai@cmu.edu]
 - Andrew Noecke^[St. Olaf College, noecke2@stolaf.edu]
 - Mykalyster Homberg^[Harvard University, mhombergbertley@college.harvard.edu]
date: "`r Sys.Date()`"
output: 
  html_document:
    theme: spacelab
    highlight: tango
    toc: true
    toc_float: true
---

```{css style settings, echo = FALSE}
blockquote {
    padding: 2px 2px;
    margin: 0 0 10px;
    font-size: 14px;
    border-left: 5px solid #eee;
}
```

```{r, echo=FALSE}
htmltools::img(src = knitr::image_uri("wnbalogo.png"), 
               alt = 'logo', 
               style = 'position:absolute; top:0; right:0; padding:65px')
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction:

Over the past decade, with the growing influence of social media and heightened popularity of global stars, interest in women's sports has skyrocketed. However, even with the appearance of high-profile campaigns for equity in sports^1^, it has nevertheless been difficult to cultivate an audience and build a market for women's sports when they receive minimal media coverage compared to their male counterparts^2^. Although major tournaments, such as the WNBA Finals, are strong pulls for fans, the lack of nationally televised games and limited marketing budgets to showcase the players throughout the year has been a barrier for sports fans --- especially established NBA fans --- to consistently engage with the WNBA even when they're interested. Furthermore, although we have seen how statistics can fuel sports passion and storytelling, it was only until recently that easy-to-access data and advanced statistics for the WNBA has even been available to the public^3^. Therefore, we seek to not only promote sustained fan engagement and interactions with the WNBA, we hope to also provide better and more accessible statistics of the players as well.

**Our project aims to make the following contributions, which will be displayed in a public facing Shiny App:**

> 1.  Develop archetypes of current WNBA players based on each player's tendencies, abilities, and overall statistics
>     -   Conduct archetype exploration on NBA players using the same variables to discover similarities and differences in the type of players between the respective leagues

> 2.  Draw comparisons between WNBA players to NBA players
>     -   Each WNBA player (that has played significant minutes/games) will be matched with 3-5 similar NBA players in terms of their play style

Ultimately, we believe that labeling each WNBA player with an archetype and developing an attachment to specific WNBA players through comparisons with NBA players can boost year-round engagement and bring the WNBA into the spotlight and keep them there for years to come.

### Shiny app inspiration:

![](shinyapp.png)

---

# Data:

To define player archetypes in the WNBA and compare WNBA players to NBA players, data must be gathered on a seasonal basis. Using Basketball Reference^4^ (BBallRef), player statistics were gathered dating back to 2018. Relevant variables included:

-   Per 100 possession statistics such as:
    -   Points, rebounds, assists
    -   Turnovers, field goals made, field goals attempted
    -   Advanced statistics designed to demonstrate player tendencies and efficiency such as:
    -   PER, Usage Rate, Win Shares
-   Play by play statistics such as:
    -   Type of turnover (bad pass, lost ball)
    -   Foul information (fouls drawn, fouls committed)
-   Shooting tendency data such as:
    -   Percentage of shots at the rim, percentage of shots from 3
    -   Percentage of shots that were assisted

This data allows both play style and effectiveness to be evaluated and considered when developing player archetypes and subsequently creating player comparisons between WNBA players and NBA players.

------------------------------------------------------------------------

*Cleaning the WNBA all stats dataset:*

-   Gathered data from the 2018 - 2021 seasons
-   Players with minutes per game \< 10 and games played \< 5 were dropped to remove players who've played an insignificant amount of time
    -   Roughly 25% of players were removed based on an ECDF graph
-   TOT rows were eliminated due to BBallRef miscalculations of TOT rows
    -   If a player played with multiple teams over the course of a season, we kept their statistics from teams on which they played more minutes
-   Re-labeled all player positions to either "G", "F", or "C" for guards, forwards, and centers respectively

*Cleaning the NBA all stats dataset:*

-   Gathered data from the 2018 - 2021 seasons
-   Players with less than 100 total minutes played were dropped to remove players who've played an insignificant amount of time
    -   Roughly 10-15% of players were removed based on an ECDF graph
-   Removed 3 outliers who did not have a TOT column
-   Re-labeled all player positions to either "PG", "SG", "SF", "PF", or "C" for point guards, shooting guards, small forwards, power forwards, and centers respectively

---

# Methods:

## 1. Developing Archetypes:

To choose which subset of variables were important in determining the archetypes, principal component analysis (PCA) was used to reduce the dimensionality of the feature space.

### PCA:

-   Filtering WNBA all stats columns before PCA:
    -   Only used data from the 2021 season
    -   Filtered out non-numeric, percentages, and highly correlated variables (i.e., fgpercent, fga_2p, corner_3s_attempt)
-   PCA results:
    -   Top 10 dimensions explain 90% of the variability
    -   Grabbed top 3 drivers in each of the top 10 PC's and removed repeated variables
    -   Checked correlation matrix and filtered out highly correlated variables
-   Variables from PCA results to use in clustering:
    -   x3p, distance, trb, orb, ows, ortg, ft, fg, pts, fga, pf, tov, drtg, stl, per, blk, ast

### Clustering:

To allow for some uncertainty in the clustering results, a Gaussian Mixture Model (GMM) was used to yield soft assignments for clustering the players.

------------------------------------------------------------------------

## 2. WNBA vs NBA Player Comparisons

In order to develop a model that would receive a WNBA player as input and output 3-5 NBA players who have similar play tendencies, a Gaussian Mixture Model (GMM) was trained using the past 5 seasons of NBA data (2018-2022). In doing so, clusters of NBA players were created, with corresponding probabilities for each player belonging to each cluster. WNBA player profiles consisting of the same variables were then fed into the model, similarly receiving probabilities of belonging to each cluster. To derive the NBA player most similar to a WNBA player, the Euclidean distance between a WNBA player's cluster probabilities and all NBA player's cluster probabilities was calculated. The NBA player with the lowest corresponding distance of probabilities was selected as the comparison for the WNBA player of interest. A GMM was chosen over K-Means clustering to take advantage of soft assignments and the probabilities generated by a GMM.

These probabilities of an observation being assigned to each cluster were then used to compare players. This was done by computing the Euclidean distance between the cluster probabilities for each observation and taking the 'closest' observation (minimum distance). This allowed a WNBA player to be fed into the model, the distance to be calculated, and to take the 'closest' NBA player and declare that as the player comparison.

---

# Results:

## EDA

First, we started by exploring the WNBA dataset to better understand the variation and relationships that exist between the variables:

```{r, echo = FALSE, message = FALSE, warning=FALSE}
# Load Libraries and Data -------------------------------------------------

library(rvest)
library(tidyverse)

wnba_all_stats <- read_csv("data/wnba_all_stats.csv")

wnba_pos <- wnba_all_stats %>%
  filter(season >= 2018) %>%
  mutate(pos = case_when(
    pos == "C-F" ~ "C",
    pos == "F-C" ~ "F",
    pos == "F-G" ~ "F",
    pos == "G-F" ~ "G",
    TRUE ~ pos
  ))
```

**Position Distribution:**

```{r position distribution, echo = FALSE, message = FALSE, warning=FALSE}
# Position Distribution

wnba_pos %>%
  filter(season <= 2021) %>%
  group_by(player, pos) %>%
  summarize(n = n()) %>% 
  ggplot(aes(x = pos)) + 
  geom_bar() + 
  theme_bw() + 
  scale_y_continuous(expand = expansion(mult = c(0, 0.05))) +
  theme(plot.title = element_text(hjust = 0.5)) + 
  labs(x = "Position",
       y = "Count",
       caption = "WNBA Players Since 2018",
       title = "Guards and Forwards are much more prevalent than Centers in the WNBA")
```

**Distribution of Minutes Per Game across WNBA Players:**

```{r mpg, echo = FALSE, message = FALSE, warning=FALSE}
# Distribution of Minutes Per Game across WNBA Players

wnba_pos %>% 
  filter(season <= 2021) %>%
  mutate(mpg = mp/g) %>%
  ggplot(aes(x = mpg, color = pos, fill = pos)) + 
  geom_density(alpha = 0.2) + 
  theme_bw() + 
  scale_y_continuous(expand = expansion(mult = c(0, 0.05)))+
  scale_x_continuous(expand = expansion(mult = c(0.01, 0.01)))  + 
  theme(plot.title = element_text(hjust = 0.5),
        legend.position = "bottom") +
  guides(color = "none") + 
  labs(x = "Minutes Per Game",
       y = "Density",
       title = "Guards tend to play more minutes than Forwards and Centers",
       caption = "WNBA player season data since 2018",
       fill = "Position")

```

**Shot distance:**

```{r distance, echo = FALSE, message = FALSE, warning=FALSE}

wnba_pos %>%
  filter(season <= 2021, g >= 5) %>%
  mutate(mpg = mp/g) %>%
  select(1:4, 46:58, 91) %>% 
  filter(mpg > 5) %>%
  select(1:5, mpg, contains("fga")) %>% 
  na.omit() %>%
  ggplot(aes(x = distance, color = pos, fill = pos)) + 
  stat_ecdf() + 
  theme_bw() + 
  scale_y_continuous(expand = expansion(mult = c(0, 0.05)))+
  scale_x_continuous(expand = expansion(mult = c(0.01, 0.01)))  +
  ggthemes::scale_color_colorblind() + 
  ggthemes::scale_fill_colorblind() + 
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        legend.position = "bottom") + 
  labs(x = "Average Shot Distance",
       y = "Proportion of Players",
       title = "A clear chasm exists between the 3 main WNBA positions regarding average shot distance",
       color = "Position")

```

**Field Goals:**

```{r fg, echo = FALSE, message = FALSE, warning=FALSE}
wnba_pos %>%
  mutate(mpg = mp / g,
         pos = fct_recode(pos, 
                    "Center" = "C",
                    "Forward" = "F",
                    "Guard" = "G")) %>%
  # Getting rid of data entry errors and players with not enough minutes
  filter(season <= 2022, g >= 5, mpg >= 5, tm != "TOT") %>%
  ggplot(aes(x = fga)) + 
  geom_histogram(fill = "cornflowerblue", alpha = 0.5, bins = 30) + 
  facet_wrap(~ pos, nrow = 3, scale = 'free_y') + 
  theme_bw() + 
  theme(strip.background = element_blank(),
        plot.title = element_text(hjust = 0.5)) +
  labs(x = "Field Goals Attempted per 100 possessions",
       y = "No. of Players",
       title = "Centers display a wider spread of FG attempts than guards and forwards"
       )
```

**Assist & Block percentage:**

```{r, echo = FALSE, message = FALSE, warning=FALSE}

astpercent <- wnba_pos %>%
  mutate(mpg = mp / g,
         pos = fct_recode(pos, 
                          "Center" = "C",
                          "Forward" = "F",
                          "Guard" = "G")) %>%
  # Getting rid of data entry errors and players with not enough minutes
  filter(season <= 2022, g >= 5, mpg >= 5, tm != "TOT") %>%
  ggplot(aes(x = astpercent)) + 
  geom_histogram(fill = "cornflowerblue", alpha = 0.5, bins = 30) + 
  facet_wrap(~ pos, nrow = 3, scale = 'free_y') + 
  theme_bw() + 
  theme(strip.background = element_blank(),
        plot.title = element_text(hjust = 0.5, size = 15)) +
  labs(x = "Assist Percentage",
       y = "No. of Players",
       title = "Assist rate leans heavily towards guards"
  )
  

blkpercent <- wnba_pos %>%
  mutate(mpg = mp / g,
         pos = fct_recode(pos, 
                          "Center" = "C",
                          "Forward" = "F",
                          "Guard" = "G")) %>%
  # Getting rid of data entry errors and players with not enough minutes
  filter(season <= 2022, g >= 5, mpg >= 5, tm != "TOT") %>%
  ggplot(aes(x = blkpercent)) + 
  geom_histogram(fill = "darkorange", alpha = 0.5, bins = 30) + 
  facet_wrap(~ pos, nrow = 3, scale = 'free_y') + 
  theme_bw() + 
  theme(strip.background = element_blank(),
        plot.title = element_text(hjust = 0.5, size = 15)) +
  labs(x = "Block Percentage",
       y = "No. of Players",
       title = "Block rate leans heavily towards bigs"
  )

library(patchwork)
astpercent + blkpercent

```




------------------------------------------------------------------------

## 1. Archetypes: {.tabset .tabset-pills}

### WNBA

*5 clusters/archetypes:*

1.
2.
3.
4.
5.

### NBA

*9 clusters/archetypes:*

1.
2.
3.
4.
5.
6. 
7. 
8. 
9. 

------------------------------------------------------------------------

## 2. Player Comparison:

- Examples?

---

# Discussion:

### Limitations

### Next steps:

-   Produce a metric, regularized adjusted plus-minus (RAPM), to measure attributes and provide better evaluations of WNBA players
    -   Utilize RAPM to create future projections of players
-   

---

# Acknowledgements:

-   Max Horowitz
-   Ron Yurko



---

# References:

[1] <https://www.teamheroine.com/blog/the-10-best-womens-sport-campaigns-of-2020>

[2] <https://www.si.com/sports-illustrated/2021/03/24/womens-sports-gender-study-discrepancy>

[3] <https://niemanreports.org/articles/covering-womens-sports/>

[4] <https://www.basketball-reference.com/wnba/years/2022_per_game.html>
